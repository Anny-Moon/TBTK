CC = g++
CFLAGS = -Wall -std=c++11 -fopenmp -O3
NVCCFLAGS = -std=c++11 -O3 --compiler-options "-fopenmp"

HOPPING_AMPLITUDE_SOURCE = src/HoppingAmplitude.cpp
TREE_NODE_SOURCE = src/TreeNode.cpp
AMPLITUDE_SET_SOURCE = src/AmplitudeSet.cpp
MODEL_SOURCE = src/Model.cpp
D_PROPERTY_EXTRACTOR_SOURCE = src/DPropertyExtractor.cpp
C_PROPERTY_EXTRACTOR_SOURCE = src/CPropertyExtractor.cpp
FILE_WRITER_SOURCE = src/FileWriter.cpp
FILE_READER_SOURCE = src/FileReader.cpp
HA_LINKED_LIST_SOURCE = src/HALinkedList.cpp
CHEBYSHEV_SOLVER_SOURCE = src/ChebyshevSolver.cpp
CHEBYSHEV_SOLVER_CUDA_SOURCE = src/ChebyshevSolver.cu
DIAGONALIZATION_SOLVER_SOURCE = src/DiagonalizationSolver.cpp
TIME_EVOLVER_SOURCE = src/TimeEvolver.cpp
UNIT_HANDLER_SOURCE = src/UnitHandler.cpp
FUNCTIONS_SOURCE = src/Functions.cpp
UTIL_SOURCE = src/Util.cpp
SOURCES = $(HOPPING_AMPLITUDE_SOURCE)
SOURCES += $(TREE_NODE_SOURCE)
SOURCES += $(AMPLITUDE_SET_SOURCE)
SOURCES += $(MODEL_SOURCE)
SOURCES += $(D_PROPERTY_EXTRACTOR_SOURCE)
SOURCES += $(C_PROPERTY_EXTRACTOR_SOURCE)
SOURCES += $(FILE_WRITER_SOURCE)
SOURCES += $(FILE_READER_SOURCE)
SOURCES += $(HA_LINKED_LIST_SOURCE)
SOURCES += $(CHEBYSHEV_SOLVER_SOURCE)
SOURCES += $(CHEBYSHEV_SOLVER_CUDA_SOURCE)
SOURCES += $(DIAGONALIZATION_SOLVER_SOURCE)
SOURCES += $(TIME_EVOLVER_SOURCE)
SOURCES += $(UNIT_HANDLER_SOURCE)
SOURCES += $(FUNCTIOS_SOURCE)
SOURCES += $(UTIL_SOURCE)

HOPPING_AMPLITUDE_OBJECT = build/HoppingAmplitude.o
TREE_NODE_OBJECT = build/TreeNode.o
AMPLITUDE_SET_OBJECT = build/AmplitudeSet.o
MODEL_OBJECT = build/Model.o
D_PROPERTY_EXTRACTOR_OBJECT = build/DPropertyExtractor.o
C_PROPERTY_EXTRACTOR_OBJECT = build/CPropertyExtractor.o
FILE_WRITER_OBJECT = build/FileWriter.o
FILE_READER_OBJECT = build/FileReader.o
HA_LINKED_LIST_OBJECT = build/HALinkedList.o
CHEBYSHEV_SOLVER_OBJECT = build/ChebyshevSolver.o
CHEBYSHEV_SOLVER_CUDA_OBJECT = build/ChebyshevSolverCUDA.o
DIAGONALIZATION_SOLVER_OBJECT = build/DiagonalizationSolver.o
TIME_EVOLVER_OBJECT = build/TimeEvolver.o
UNIT_HANDLER_OBJECT = build/UnitHandler.o
FUNCTIONS_OBJECT = build/Functions.o
UTIL_OBJECT = build/Util.o
OBJECTS = $(HOPPING_AMPLITUDE_OBJECT)
OBJECTS += $(TREE_NODE_OBJECT)
OBJECTS += $(AMPLITUDE_SET_OBJECT)
OBJECTS += $(MODEL_OBJECT)
OBJECTS += $(D_PROPERTY_EXTRACTOR_OBJECT)
OBJECTS += $(C_PROPERTY_EXTRACTOR_OBJECT)
OBJECTS += $(FILE_WRITER_OBJECT)
OBJECTS += $(FILE_READER_OBJECT)
OBJECTS += $(HA_LINKED_LIST_OBJECT)
OBJECTS += $(CHEBYSHEV_SOLVER_OBJECT)
OBJECTS += $(CHEBYSHEV_SOLVER_CUDA_OBJECT)
OBJECTS += $(DIAGONALIZATION_SOLVER_OBJECT)
OBJECTS += $(TIME_EVOLVER_OBJECT)
OBJECTS += $(UNIT_HANDLER_OBJECT)
OBJECTS += $(FUNCTIONS_OBJECT)
OBJECTS += $(UTIL_OBJECT)

TIGHT_BINDING_LIB_STATIC = build/libTightBinding.a


all: $(TIGHT_BINDING_LIB_STATIC)

$(TIGHT_BINDING_LIB_STATIC): $(OBJECTS)
	ar rcs $(TIGHT_BINDING_LIB_STATIC) $(OBJECTS)

$(HOPPING_AMPLITUDE_OBJECT): $(HOPPING_AMPLITUDE_SOURCE)
	$(CC) $(CFLAGS) -c $(HOPPING_AMPLITUDE_SOURCE) -o $(HOPPING_AMPLITUDE_OBJECT)

$(TREE_NODE_OBJECT): $(TREE_NODE_SOURCE)
	$(CC) $(CFLAGS) -c $(TREE_NODE_SOURCE) -o $(TREE_NODE_OBJECT)

$(AMPLITUDE_SET_OBJECT): $(AMPLITUDE_SET_SOURCE)
	$(CC) $(CFLAGS) -c $(AMPLITUDE_SET_SOURCE) -o $(AMPLITUDE_SET_OBJECT)

$(MODEL_OBJECT): $(MODEL_SOURCE)
	$(CC) $(CFLAGS) -c $(MODEL_SOURCE) -o $(MODEL_OBJECT)

$(D_PROPERTY_EXTRACTOR_OBJECT): $(D_PROPERTY_EXTRACTOR_SOURCE)
	$(CC) $(CFLAGS) -c $(D_PROPERTY_EXTRACTOR_SOURCE) -o $(D_PROPERTY_EXTRACTOR_OBJECT)

$(C_PROPERTY_EXTRACTOR_OBJECT): $(C_PROPERTY_EXTRACTOR_SOURCE)
	$(CC) $(CFLAGS) -c $(C_PROPERTY_EXTRACTOR_SOURCE) -o $(C_PROPERTY_EXTRACTOR_OBJECT)

$(FILE_WRITER_OBJECT): $(FILE_WRITER_SOURCE)
	$(CC) $(CFLAGS) -I$(TBTK_dir)/hdf5/hdf5-build/hdf5/include -I$(TBTK_dir)/hdf5/hdf5-1.8.16/include -c $(FILE_WRITER_SOURCE) -o $(FILE_WRITER_OBJECT)

$(FILE_READER_OBJECT): $(FILE_READER_SOURCE)
	$(CC) $(CFLAGS) -I$(TBTK_dir)/hdf5/hdf5-build/hdf5/include -I$(TBTK_dir)/hdf5/hdf5-1.8.16/include -c $(FILE_READER_SOURCE) -o $(FILE_READER_OBJECT)

$(HA_LINKED_LIST_OBJECT): $(HA_LINKED_LIST_SOURCE)
	$(CC) $(CFLAGS) -c $(HA_LINKED_LIST_SOURCE) -o $(HA_LINKED_LIST_OBJECT)

$(CHEBYSHEV_SOLVER_OBJECT): $(CHEBYSHEV_SOLVER_SOURCE)
	$(CC) $(CFLAGS) -c $(CHEBYSHEV_SOLVER_SOURCE) -o $(CHEBYSHEV_SOLVER_OBJECT)

$(CHEBYSHEV_SOLVER_CUDA_OBJECT): $(CHEBYSHEV_SOLVER_CUDA_SOURCE)
	nvcc $(NVCCFLAGS) -c $(CHEBYSHEV_SOLVER_CUDA_SOURCE) -o $(CHEBYSHEV_SOLVER_CUDA_OBJECT)

$(DIAGONALIZATION_SOLVER_OBJECT): $(DIAGONALIZATION_SOLVER_SOURCE)
	$(CC) $(CFLAGS) -c $(DIAGONALIZATION_SOLVER_SOURCE) -o $(DIAGONALIZATION_SOLVER_OBJECT)

$(TIME_EVOLVER_OBJECT): $(TIME_EVOLVER_SOURCE)
	$(CC) $(CFLAGS) -c $(TIME_EVOLVER_SOURCE) -o $(TIME_EVOLVER_OBJECT)

$(UNIT_HANDLER_OBJECT): $(UNIT_HANDLER_SOURCE)
	$(CC) $(CFLAGS) -c $(UNIT_HANDLER_SOURCE) -o $(UNIT_HANDLER_OBJECT)

$(FUNCTIONS_OBJECT): $(FUNCTIONS_SOURCE)
	$(CC) $(CFLAGS) -c $(FUNCTIONS_SOURCE) -o $(FUNCTIONS_OBJECT)

$(UTIL_OBJECT): $(UTIL_SOURCE)
	$(CC) $(CFLAGS) -c $(UTIL_SOURCE) -o $(UTIL_OBJECT)


clean:
	rm -r build/*

